#!/bin/sh
set -e

# Build env
mkdir -p ~/build
cd ~/build

# Download the latest source
curl "https://api.github.com/repos/vim/vim/tags?per_page=1" > vim_latest_tag.json
latest_commit=$(grep "sha" vim_latest_tag.json | cut -d'"' -f4 | head -c7)
latest_tarball_url=$(grep "tarball_url" vim_latest_tag.json | cut -d'"' -f4)
latest_version=$(printf "%s\n" $latest_tarball_url | cut -d/ -f10)
curl -L -o vim-$latest_version.tar.gz $latest_tarball_url
tar -xf vim-$latest_version.tar.gz
vimdir="vim-vim-$latest_commit"
cd $vimdir

# Build and install vim
./configure \
	--without-x \
	--disable-gui \
	--disable-canberra \
	--disable-netbeans \
	--enable-multibyte \
	--enable-terminal \
	--enable-luainterp=dynamic \
	--with-luajit
make -j$(nproc)
sudo make install
